{% extends "base.html" %}

{% block title %}New Post - {{ site_name }}{% endblock %}

{% block content %}
<hgroup>
    <h1>Create New Post</h1>
    <p>Write and publish a new blog post</p>
</hgroup>

<form method="post" action="/posts/new">
    <label for="title">
        Title
        <input type="text" id="title" name="title" required placeholder="Enter post title">
    </label>

    <label for="slug">
        Slug
        <input type="text" id="slug" name="slug" required placeholder="post-url-slug">
        <small>This will be used in the URL: /post/your-slug</small>
    </label>

    <label for="content">
        Content
        <textarea id="content" name="content" rows="15" placeholder="Write your post content here (HTML supported)..."></textarea>
    </label>

    <label for="is_published">
        <input type="checkbox" id="is_published" name="is_published" role="switch">
        Publish immediately
    </label>

    <div style="display: flex; gap: 1rem;">
        <button type="submit">Create Post</button>
        <a href="/posts/my" role="button" class="outline">Cancel</a>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script>
(function() {
    const titleInput = document.getElementById('title');
    const slugInput = document.getElementById('slug');
    let slugManuallyEdited = false;

    slugInput.addEventListener('input', function() {
        slugManuallyEdited = this.value.length > 0;
    });

    titleInput.addEventListener('input', function() {
        if (slugManuallyEdited) return;

        slugInput.value = this.value
            .toLowerCase()
            .trim()
            .replace(/[^\w\s-]/g, '')
            .replace(/\s+/g, '-')
            .replace(/-+/g, '-');
    });
})();
</script>
{% endblock %}
